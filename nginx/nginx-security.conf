# Only HTTP-2 and HTTP-3 (QUIC) are allowed
client_max_body_size 200M;
proxy_read_timeout 300s;
proxy_send_timeout 300s;
proxy_connect_timeout 60s;

# Rate limiting zones
limit_req_zone $binary_remote_addr zone=api:10m rate=5r/s;
limit_req_zone $binary_remote_addr zone=web:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=login:10m rate=1r/m;

# Connection limiting
limit_conn_zone $binary_remote_addr zone=addr:10m;

# Apply rate limiting and connection limiting
limit_req zone=web burst=10 nodelay;
limit_conn addr 12;

# Block malicious patterns
map $http_user_agent $bad_bot {
    default 0;
    "~*GenomeCrawlerd" 1;
    "~*zgrab" 1;
    "~*libredtail" 1;
    "~*Hello from Palo Alto" 1;
}

# Block malicious IPs
geo $bad_ip {
    default 0;
    104.234.115.131 1;
    50.117.21.19 1;
    91.224.92.17 1;
}

# Hide nginx version
server_tokens off;

# Real IP forwarding  
real_ip_header X-Forwarded-For;
set_real_ip_from 172.16.0.0/12;