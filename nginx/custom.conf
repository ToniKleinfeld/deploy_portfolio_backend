# Only proxy-specific settings
proxy_buffer_size 16k;
proxy_buffers 16 16k;
proxy_busy_buffers_size 32k;

# Increase hash sizes to avoid collisions
proxy_headers_hash_max_size 1024;     
proxy_headers_hash_bucket_size 128;

# Additional Django-specific headers
proxy_set_header X-Forwarded-Host $server_name;
proxy_set_header X-Forwarded-Port $server_port;

proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
proxy_next_upstream_tries 2;
proxy_next_upstream_timeout 10s;

upstream_keepalive_connections 32;
upstream_keepalive_requests 100;
upstream_keepalive_timeout 60s;