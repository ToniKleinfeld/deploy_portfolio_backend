# Only proxy-specific settings
proxy_buffer_size 4k;
proxy_buffers 8 4k;
proxy_busy_buffers_size 8k;

# Increase hash sizes to avoid collisions
proxy_headers_hash_max_size 1024;     
proxy_headers_hash_bucket_size 128;

# Clean Host Header to prevent duplicates
map $http_host $clean_host {
    default $http_host;
    ~^([^,]+),.*$ $1;
}

# Proxy headers (important for nginx-proxy)
proxy_set_header Host $clean_host;   
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;

# Additional Django-specific headers
proxy_set_header X-Forwarded-Host $server_name;
proxy_set_header X-Forwarded-Port $server_port;