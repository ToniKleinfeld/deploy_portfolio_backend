# ====== SECURITY SETTINGS ======
# Only HTTP-2 and HTTP-3 (QUIC) are allowed
client_max_body_size 500M;
proxy_read_timeout 120s;
proxy_send_timeout 120s;
proxy_connect_timeout 30s;

# Block malicious patterns
map $http_user_agent $bad_bot {
    default 0;
    "~*GenomeCrawlerd" 1;
    "~*zgrab" 1;
    "~*libredtail" 1;
    "~*Hello from Palo Alto" 1;
}

# Block malicious IPs
geo $bad_ip {
    default 0;
    104.234.115.131 1;
    50.117.21.19 1;
    91.224.92.17 1;
}

# Hide nginx version
server_tokens off;

# Real IP forwarding  
real_ip_header X-Forwarded-For;
set_real_ip_from 172.16.0.0/12;

# ====== PROXY OPTIMIZATIONS ======

# Only proxy-specific settings
proxy_buffer_size 16k;
proxy_buffers 16 16k;
proxy_busy_buffers_size 32k;

# Increase hash sizes to avoid collisions
proxy_headers_hash_max_size 1024;     
proxy_headers_hash_bucket_size 128;

# Additional Django-specific headers
proxy_set_header X-Forwarded-Host $server_name;
proxy_set_header X-Forwarded-Port $server_port;